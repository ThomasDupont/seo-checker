{"version":3,"file":"tReentrantLock.js","names":["Effect","Equal","FiberId","dual","HashMap","Option","core","tRef","TReentrantLockSymbolKey","TReentrantLockTypeId","Symbol","for","WriteLockTypeId","ReadLockTypeId","TReentranLockImpl","state","constructor","ReadLock","readers","readLocks","Array","from","reduce","acc","curr","writeLocks","readLocksHeld","fiberId","getOrElse","get","writeLocksHeld","_fiberId","WriteLock","equals","isReadLock","lock","isWriteLock","emptyReadLock","empty","makeReadLock","count","make","noOtherHolder","readLock","isEmpty","size","has","adjustReadLock","adjustment","total","newTotal","Error","remove","set","adjustRead","self","delta","withSTMRuntime","runtime","unsafeGet","journal","result","unsafeSet","succeed","threadName","retry","acquireRead","acquireWrite","fiberReadLocks","effect","fiberWriteLocks","writeLock","locked","zipWith","readLocked","writeLocked","x","y","map","acquireRelease","commit","releaseRead","releaseWrite","withLock","withWriteLock","withReadLock","uninterruptibleMask","restore","zipRight","ensuring"],"sources":["../../../../src/internal/stm/tReentrantLock.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}